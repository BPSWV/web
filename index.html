<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bloomery Presbyterian Church | Home | Worship in Bloomery, West Virginia</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="description" content="Bloomery Presbyterian Church in Bloomery, West Virginia, has served the Hampshire County community since 1825. Join us for worship, fellowship, and a rich heritage of faith.">
  <meta name="keywords" content="Bloomery Presbyterian Church, Bloomery WV, Hampshire County, West Virginia church, Presbyterian, worship, historic church, Christian community, Capon Valley, Sunday service">
  <meta property="og:title" content="Bloomery Presbyterian Church | Worship in Bloomery, WV">
  <meta property="og:description" content="Serving Bloomery, West Virginia since 1825. Join us for worship, community, and faith.">
  <meta property="og:image" content="https://www.bloomerypresbyterian.org/images/church-exterior.jpg">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.bloomerypresbyterian.org/">
  <link rel="canonical" href="https://www.bloomerypresbyterian.org">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Permanent Banner -->
<div id="permanent-banner"
     style="background-color:#800000;color:white;text-align:center;
            padding:12px 0;font-weight:bold;font-size:1.2rem;">
  Living Acts of Kindness
</div>
  <!-- Dynamic banner (hidden until announcement) -->
  <div id="top-banner"
       style="display:none;background-color:#004080;color:white;text-align:center;padding:10px 0;font-weight:bold;font-size:1.1rem;"
       aria-hidden="true"></div>

  <header>
    <img src="images/church-logo.png" alt="Bloomery Presbyterian Church Logo" class="logo">
    <h1>Bloomery Presbyterian Church</h1>
    <!-- Nav placeholder -->
    <div id="nav-placeholder"></div>
  </header>
  <main>
    <section id="home">
      <div class="hero">
        <img src="images/church-exterior.jpg" alt="Exterior of Bloomery Presbyterian Church in Bloomery, West Virginia" class="hero-img">
        <div class="hero-text">
          <h2>Welcome to Bloomery Presbyterian Church</h2>
          <p>
            <strong>Bloomery Presbyterian Church</strong> has been a beacon of faith and community in <strong>Bloomery, West Virginia</strong> since 1825. As one of the oldest churches in Hampshire County, we are dedicated to sharing the love of Christ through worship, outreach, and fellowship.
          </p>
          <p>
            Our congregation welcomes everyone—families, individuals, and visitors—seeking spiritual growth and a caring Christian community. Join us for Sunday worship in our historic sanctuary and experience the warmth and tradition of Presbyterian faith in the heart of the Capon Valley.
          </p>
        </div>
      </div>
      <div class="quick-info">
        <h3>Sunday Worship: <time datetime="10:00">10:00 AM</time></h3>
        <p><strong>Location:</strong> <a href="https://maps.app.goo.gl/jth4yuWprP993q1j6" target="_blank" rel="noopener">127 Bloomery Pike, Bloomery, WV 26817</a></p>
        <p><strong>All are welcome!</strong></p>
      </div>
      <section aria-labelledby="youtube-heading" class="youtube-section" style="margin: 30px 0; text-align:center;">
        <h2 id="youtube-heading" style="font-size:1.25rem;">Watch Our Services on YouTube</h2>
        <a href="https://www.youtube.com/channel/UCS2kIs8oVJ1U25cV7_N-b4Q" target="_blank" rel="noopener" class="button" style="display:inline-block;">
          <img src="images/youtube-icon.png" alt="YouTube" style="width:32px;vertical-align:middle;margin-right:8px;">
          Visit Our YouTube Channel
        </a>
        <p style="margin-top:10px;">
          Watch recent worship services, sermons, and special events from Bloomery Presbyterian Church on our <a href="https://www.youtube.com/channel/UCS2kIs8oVJ1U25cV7_N-b4Q" target="_blank" rel="noopener">YouTube channel</a>.
        </p>
      </section>
      <section aria-labelledby="history-heading" style="margin: 40px 0 0 0;">
        <h2 id="history-heading" style="font-size:1.25rem;">A Rich Heritage of Faith in Hampshire County</h2>
        <p>
          Founded by Scotch-Irish settlers, our church has served the Bloomery and Hampshire County area for nearly 200 years. The historic white church building and its adjacent cemetery stand as a testament to generations of faith, resilience, and community service. Bloomery Presbyterian Church is proud to be a member of the Presbyterian Church (USA) and the Shenandoah Presbytery.
        </p>
        <p>
          <a href="about.html">Learn more about our history &rarr;</a>
        </p>
      </section>
    </section>
  </main>
  <footer>
    <p>&copy; 2025 Bloomery Presbyterian Church. All rights reserved.</p>
    <p>
      <a href="https://www.youtube.com/channel/UCS2kIs8oVJ1U25cV7_N-b4Q" target="_blank" rel="noopener">
        <img src="images/youtube-icon.png" alt="Bloomery Presbyterian Church YouTube Channel" style="width:20px;vertical-align:middle;"> YouTube
      </a>
    </p>
  </footer>

  <!-- Load nav.html into nav-placeholder -->
  <script>
    fetch('nav.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('nav-placeholder').innerHTML = data;

        // Highlight active nav link based on current page
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        const navLinks = document.querySelectorAll('#nav-placeholder a.nav-link');
        navLinks.forEach(link => {
          if (link.getAttribute('href') === currentPage) {
            link.classList.add('active');
          }
        });
      })
      .catch(error => console.error('Error loading navigation:', error));
  </script>

  <!-- Updated Banner update script (with cache-busting, JSONP fallback, and hide-if-empty) -->
  <script>
  (function(){
    const BANNER_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwvis5WPKKF7BlrIVRKihejeBda1MWYXKj4aDyxDrZHrjsYrVh6mxe-AevcGCUQEo20/exec';

    function bestTextColorForBackground(hex) {
      if (!hex) return '#ffffff';
      const m = hex.match(/^#?([0-9a-f]{6})$/i);
      if (!m) return '#ffffff';
      const r = parseInt(m[1].substr(0,2),16);
      const g = parseInt(m[1].substr(2,2),16);
      const b = parseInt(m[1].substr(4,2),16);
      const lum = (0.299*r + 0.587*g + 0.114*b) / 255;
      return lum > 0.6 ? '#000000' : '#ffffff';
    }

    // JSONP fallback: adds script tag callback=__bannerCB
    function jsonpFetch(url) {
      return new Promise((resolve, reject) => {
        const cbName = '__bannerCB_' + Date.now();
        window[cbName] = function(data) {
          resolve(data);
          cleanup();
        };
        function cleanup() {
          delete window[cbName];
          script.remove();
        }
        const script = document.createElement('script');
        script.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cbName;
        script.onerror = function(err){
          cleanup();
          reject(err);
        };
        document.body.appendChild(script);
      });
    }

    async function fetchBanner() {
      const url = BANNER_ENDPOINT + '?_ts=' + Date.now(); // cache-buster
      try {
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error('Fetch failed: ' + res.status);
        const data = await res.json();
        return data;
      } catch (err) {
        console.warn('Fetch failed, trying JSONP fallback:', err);
        try {
          return await jsonpFetch(BANNER_ENDPOINT);
        } catch (err2) {
          console.error('JSONP fallback failed:', err2);
          throw err2;
        }
      }
    }

    async function updateBannerOnce() {
      const bannerEl = document.getElementById('top-banner');
      if (!bannerEl) return;
      try {
        const data = await fetchBanner();
        console.log('Banner data:', data);
        const text = data && data.banner ? String(data.banner).trim() : '';
        const color = data && data.color ? data.color : '';
        const textColor = data && data.textColor ? data.textColor : '';

        if (text.length > 0) {
          bannerEl.style.display = '';
          bannerEl.setAttribute('aria-hidden','false');
          bannerEl.textContent = text;
          if (color) {
            bannerEl.style.backgroundColor = color;
            bannerEl.style.color = textColor || bestTextColorForBackground(color);
          } else {
            bannerEl.style.backgroundColor = '#004080';
            bannerEl.style.color = '#ffffff';
          }
        } else {
          // hide when empty
          bannerEl.style.display = 'none';
          bannerEl.setAttribute('aria-hidden','true');
          bannerEl.textContent = '';
          bannerEl.style.backgroundColor = '';
          bannerEl.style.color = '';
        }
      } catch (err) {
        console.error('Could not update banner:', err);
        // keep banner hidden on error
      }
    }

    // Initial fetch + polling
    updateBannerOnce();
    setInterval(updateBannerOnce, 30000); // adjust as needed
  })();
  </script>

  <script src="app.js"></script>
</body>
</html>
